service: wisaw


# Use serverless-webpack plugin to transpile ES6/ES7
plugins:
  - serverless-webpack
# Enable auto-packing of external modules
custom:
  webpackIncludeModules: true

provider:
  name: aws
  runtime: nodejs6.10
  memorySize: 128
  timeout: 30
  versionFunctions: false # optional, default is true
  environment:
    DATABASE_URL: ${file(.db.${opt:stage}.yml):DATABASE_URL}


functions:
  helloWorldRead: # just for testing purposes
    handler: api/src/controllers/hello_world.main
    description: greetings message for world
    events:
      - http:
          path: hello
          method: get
          private: false
  photosCleanup: # http endpoint
    handler: api/src/controllers/photos/cleanupPhotos.main
    description: cleaning up old photos
    events:
      - http:
          path: photos/cleanup
          method: get
          private: false
  photosCleanupContinuously: # the same as above (reusing the same function), but is invoked by a scheduler
    handler: api/src/controllers/photos/cleanupPhotos.main
    description: cleaning up old photos periodically once an hour
    events:
      - schedule:
          rate: rate(1 hour)
          enabled: true
  abuseReportCreate: # http endpoint
    handler: api/src/controllers/abuseReports/create.main
    description: cleaning up old photos
    events:
      - http:
          path: /abusereport
          method: post
          private: false
